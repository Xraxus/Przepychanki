{% extends "base.htm" %}


{% block body %}
    <h1>Faza 1</h1>
    <p>Czas na przepychanki kolejkowe.</p>
    <p>Dzień {{ game.day_count }}: {{ game.board.current_day }}</p>

    <table border="1">
        <tr>
            <th>Dzisiejsze dostawy</th>
        </tr>
        {% for supply_card in game.board.todays_supply_cards %}
            <tr>
                <td>{{ supply_card.category }} : {{ supply_card.amount }}</td>
            </tr>
        {% endfor %}
    </table><br>

    <h2>Gracz</h2>
    <form method="POST">
        <table border=1>
            <tr>
                <th>{{ player.color }}: {{ player.name }}</th>
            </tr>
            <tr>
                <td>Pionki w ręce: {{ player.pawns|length }}</td>
            </tr>
            <tr>
                {% for card in player.jostling_hand %}
                    <td>
                        <button type="submit" name="card" value="{{ card.name }}" class="tooltip jost-card">
                            <img alt="{{ card.name }}"
                            {% if card.name == "Kolega w Komitecie" %}
                                src="/static/img/kolega.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>sprawdź dwie dostawy zaplanowane na kolejny dzień.</span>
                            {% elif card.name == "Krytyka władzy" %}
                                src="/static/img/krytyka.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>przesuń wybrany pionek o dwa miejsca do tyłu.</span>
                            {% elif card.name == "Lista społeczna" %}
                                src="/static/img/lista.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>odwróć kolejkę tył na przód.</span>
                            {% elif card.name == "Matka z dzieckiem" %}
                                src="/static/img/matka.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>przesuń swój pionek na pierwsze miejsce kolejki.</span>
                            {% elif card.name == "Pan tu nie stał" %}
                                src="/static/img/pan.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>przełóż swój pionek o jedno miejsce do przodu.</span>
                            {% elif card.name == "Pomyłka w dostawie" %}
                                src="/static/img/pomylka.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>przełóż wybrany towar do dowolnego sklepu.</span>
                            {% elif card.name == "Remanent" %}
                                src="/static/img/remanent.png">
                                <span class="tooltiptext"><strong>{{ card.name }}</strong><br>zamknij sklep w tej turze (nie działają na niego karty: "Zwiekszona dostawa", "Pomyłka w dostawie", "Towar spod lady").</span>
                            {% elif card.name == "Szczęśliwy traf" %}
                                src="/static/img/szczesliwy.png">
                                 <span class="tooltiptext"><strong>{{ card.name }}</strong><br>przesuń własny pionek na drugie miejsce do dowonlej kolejki.</span>
                            {% elif card.name == "Towar spod lady" %}
                                src="/static/img/towar.png">
                                 <span class="tooltiptext"><strong>{{ card.name }}</strong><br>jeśli jesteś pierwszy w kolejce, natychmiastowo weź towar.</span>
                            {% elif card.name == "Zwiększona dostawa" %}
                                src="/static/img/zwiekszona.png">
                                 <span class="tooltiptext"><strong>{{ card.name }}</strong><br>dołóż jeden towar do sklepu.</span>
                            {% endif %}
                        </button>
                    </td>
                {% endfor %}
            </tr>
            <tr>
                <td>
                    <button type="submit" name="card" value="Spasuj">Spasuj</button>
                </td>
            </tr>
        </table>
    </form><br>
    <h2>Sklepy</h2>
    {% for shop_key, shop_value in game.board.shops.items() %}
        <table border=1>
            <tr>
                <th>{{ shop_value.name }}{% if shop_value.is_open == False %}
                    <span style="color: red"> (remanent)</span>{% endif %}</th>
            </tr>
            <tr>
                <th>Towary</th>
                {% for good in shop_value.available_goods %}
                    <td><strong>{{ good.name }}</strong>, {{ good.description }}</td>
                {% endfor %}
            </tr>
            <tr>
                <th>Kolejka</th>
                {% for pawn in shop_value.queue %}
                    <td>{{ pawn }}</td>
                {% endfor %}
            </tr>
            <tr>
                <th>Pozostałe towary:</th>
                <td>{{ game.board.count_by_shop_type(shop_value.name) }}</td>
            </tr>

        </table><br>
    {% endfor %}

    <table border="1">
        <tr>
            <th colspan="100%">Bazar</th>
        </tr>
        {% for shop_name,shop_items in game.board.bazaar.available_goods.items() %}
            <tr {% if shop_name == game.board.bazaar.sale_category %} class="yellow-background"{% endif %}>
                <th>{{ shop_name }}</th>

                {% for good in shop_items %}
                    <td><strong>{{ good.name }}</strong>, {{ good.description }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
        <tr>
            <th>Kolejka</th>
            <td colspan="100%">{{ game.board.bazaar.queue }}</td>
        </tr>
    </table>
    {% for player in game.players %}
        <br>
        <table border="1">
            <tr>
                <th colspan="100%">Lista zakupów gracza {{ player.name }}</th>
            </tr>
            <tr>
                <td colspan="100%"><strong>{{ player.shopping_list.shopping_list_number }}
                    - {{ player.shopping_list.shopping_list_name }}</strong></td>
            </tr>
            {% for category, amount in player.shopping_list.needed_items.items()|sort(attribute='1', reverse=True) %}
                {% if amount != 0 %}
                    <tr>
                        <td><strong>{{ category }}</strong></td>
                        <td>{{ amount }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
    {% endfor %}
{% endblock %}